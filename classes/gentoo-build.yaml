inherit: [in-docker]

# Note: this script defines two functions that come on stage when portages
# snapshot is located on compressed squashfs system. Internally, invokes FUSE
# mouting procedures for squashfs:
# mount:
#   $ squashfuse /tmp/gentoo-20180318.xz.sqfs $(pwd)/mountpoint
# umount:
#   $ fusermount -u $(pwd)/mountpoint

depends:
    - gentoo-portages

environment:
    GENTOO_BASE_IMAGE: "gentoo/stage3-amd64"

buildTools: [docker]
buildScript: |
    # Note: these few are only used when portages are on the squashfs:
    mount_sqfs_portages() {
        mkdir -p portages.mount
        squashfuse "$PORTAGES_SNAPSHOT" portages.mount
    }
    umount_sqfs_portages() {
        fusermount -u portages.mount
    }
